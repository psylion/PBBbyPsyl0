<html>

<head>
    <link href="bootstrap/css/bootstrap.min.css" rel="stylesheet" media="screen">
    <link href="css/hackers.css" rel="stylesheet" media="screen">
    <link href="js/jquery-ui-1.12.1/jquery-ui.min.css" rel="stylesheet" media="screen">
    <script src="js/jquery-2.1.1.min.js" type="text/javascript"></script>
    <script src="js/jquery-ui-1.12.1/jquery-ui.min.js" type="text/javascript"></script>
    <!-- header('Content-Type: application/json; charset=utf-8'); -->
    <script>
        $(function () {
            //$("#jsonFiles").selectmenu();
            $("#jsonFiles").selectmenu({
                select: function (event, data) {
                    //var firstVal = $('#jsonFiles').find(':selected').text();
                    //alert(firstVal);
                    $('#debug').html("FROM SELECT selected file: " + $('#jsonFiles').val());
                    stat1();
                    return false;
                }
            });
            $("#jsonFiles").on("selectmenuselect", function (event, ui) {
                $('#debug').html("FROM selectemenuselect selected file: " + $('#jsonFiles').val());
                stat1();
            });

        });
    </script>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>

<body>
    <script>
        $jsonData = [];
        $(document).ready(function () {
            $(".brand").append(" - Stats");

            $.get("/json", function (data) {
                data.reverse();
                $.each(data, function (i, item) {
                    $("#content").append(item.name + "<br/>");

                    $('#jsonFiles').append($('<option>', {
                        value: item.name,
                        text: item.name
                    }));
                })
                $('#jsonFiles :first-child').attr('selected', 'selected');
                $('#jsonFiles').selectmenu('refresh').trigger('selectmenuselect');
            });

        });
        function stat1() {
            $.getJSON("json/" + $('#jsonFiles').val(), function (data) {
                $jsonData = data;
                $("#content").html("Count PPB entries : ");
                $("#content").append("<br/>data: " + data.length);
                $("#content").append("<br/>PBB: " + data.filter(function (o) { return o.otitle.indexOf('PBB') > -1; }).length);
            });
        }
        function stat2() {

            var res = $.grep($jsonData, function (n, i) {
                return n.otitle.toLowerCase().indexOf($("#artist").val().toLowerCase()) > -1;
            });
            var outputstr = "<table style='border:solid 1px #000; border-collapse:collapse;' border='1' cellpadding='10'>" +
                "<thead><th>Genre</th><th>Artist</th><th>Title</th><th>label</th><th>time</th></thead>";
            $.each(res, function (i, n) {
                outputstr += "<tr><td>" + n.par + "</td><td>" + n.artist + "</td><td>" + n.title + "</td><td>" + n.label + "</td><td>" + n.time + "</td></tr>";
            });
            outputstr += "</table>";
            $("#content").html(outputstr);
            //$("#content").append("stat2: "+res.length);
        }
    </script>
    <div class="navbar navbar-inverse navbar-fixed-top">
        <div class="navbar-inner"><span id="timeSpan" style="position: absolute;"></span>
            <div class="container">
                <button type="button" class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="brand" href="#">PBBbyPsyl0</a>

                <div class="nav-collapse collapse">
                    <ul class="nav">
                        <li class="active"><a href="#">Home</a></li>
                        <li><a href="#about">About</a></li>
                        <li><a href="#contact">Contact</a></li>
                        <li class="dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">Dropdown <b
                                    class="caret"></b></a>
                            <ul class="dropdown-menu">
                                <li><a href="#">Action</a></li>
                                <li><a href="#">Another action</a></li>
                                <li><a href="#">Something else here</a></li>
                                <li class="divider"></li>
                                <li class="nav-header">Nav header</li>
                                <li><a href="#">Separated link</a></li>
                                <li><a href="#">One more separated link</a></li>
                            </ul>
                        </li>
                    </ul>
                    <form class="navbar-form pull-right">
                        <input class="span2" type="text" placeholder="Email">
                        <input class="span2" type="password" placeholder="Password">
                        <button type="submit" class="btn">Sign in</button>
                    </form>
                </div>
                <!--/.nav-collapse -->
            </div>
        </div>
    </div>
    <div class="container">
        <!-- Main hero unit for a primary marketing message or call to action -->
        <div class="hero-unit">
            <h2>Welcome to PBB-by-Psyl0</h2>
            <p>
                This is an history log of what is playing on PBB Radio. This site is currently under construction... by
                then end I would like to offer a way to search by time and also display statistics.<br />
                I started this project by the end of April 2021... and I'm still looking to put this online. </p>
            <!-- <p><a href="#" class="btn btn-primary btn-large">Learn more »</a></p> -->
        </div>
        <!-- Example row of columns -->
        <div class="row">
            <div class="span8">
                <h2>Stats</h2>
                <fieldset>
                    <label for="jsonFiles">Select a file</label>
                    <select name="jsonFiles" id="jsonFiles">
                    </select>
                </fieldset>
                Search artist/title: <input type="text" id="artist" size="4" onkeyup="stat2();" />
                <div id="content"></div>
                
                <!-- <p><a class="btn" href="#">View details »</a></p> -->
            </div>
        </div>
        <div class="row">
            <div class="span3">
                <h4>Debug output</h4>
                <div id="debug"> </div>
                <div id="time"> </div>
                <div id="load"> </div>
                <div id="saved"> </div>
                </p>
                <!-- <p><a class="btn" href="#">View details »</a></p> -->
            </div>
        </div>
        <hr>

        <footer>
            <p>© PBBbyPsyl0 2021</p>
        </footer>

    </div>
    <hr />
    <!-- Le javascript  ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="/bootstrap/js/bootstrap.min.js"></script>

</body>

</html>