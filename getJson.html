<html>

<head>
    <link href="/bootstrap/css/bootstrap.min.css" rel="stylesheet" media="screen">
    <script src="/js/jquery-3.6.0.js" type="text/javascript"></script>
    <!-- header('Content-Type: application/json; charset=utf-8'); -->

    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>

<body>
    <script>
        $(document).ready(function () {
            $pload = new Date();
            $checkSaved = new Date();
            $lastSaved = new Date();
            $lastLoad = new Date();
            // correcting difference between javascript time locale between Mac and Windows
            //            var d = new Date();
            $2day = $pload.toJSON().substr(0, 10).replaceAll("-", "");
            console.log("today: " + $2day);
            $pload = $pload.toTimeString().substr(0, 8);
            $("#time").html("page loaded: " + $pload);
            $jsonFile = $2day + "results.json";
            reloadJSON();
            $("#load").html("<br/>lastSaved (main):" + $lastSaved);
            var myVar = setInterval(function () { myTimer('bucht'); }, 5000);
        });
        function reloadJSON() {
            $.getJSON($jsonFile, function (data) {
                var items = [];
                data.reverse();
                $.each(data, function (i, item) {
                    items.push("<li id='" + i + "'>" + item.otitle + "</li>");
                    if (i == 10) return false;
                });
                $("<ul/>", {
                    "class": "my-new-list",
                    html: items.join("")
                }).appendTo("#content");

            });
            $lastSaved = getLastSaved();
            console.log($lastSaved);
        }
        function getLastSaved() {
            var xhr = $.ajax({
                url: $jsonFile,
                success: function (response) {
                    $checkSaved = new Date(xhr.getResponseHeader("Last-Modified")).toTimeString().substr(0, 8);
                    $("#saved").html("<br/>saved (from getLastSaved): " + $checkSaved);
                }
            });
            //console.log($lastSaved);
            return $checkSaved;
        }
        function myTimer(str) {
            $pload = new Date();
            $pload = $pload.toTimeString().substr(0, 8);
            //$lastSaved = $lastSaved.toTimeString().substr(0,8);
            $("#time").html("check refresh: " + $pload + "(" + str + ")" +
                "<br/>lastSaved (myTimer): " + $lastSaved +
                "<br/>saved (getLastSaved): " + getLastSaved() +
                "<br/>saved (checkSaved): " + $checkSaved);
            //console.log("fromTimer:" + $lastSaved +"<br/>checkSaved"+$checkSaved);
            if ($lastSaved != $checkSaved) {
                $("#content").html("");
                reloadJSON();
                $("#time").append("<b>Reloaded</b>");
                $("#load").html("<br/>lastLoad: " + $lastLoad + " and saved:" + getLastSaved());
            }
        }
    </script>
    <div class="navbar navbar-inverse navbar-fixed-top">
        <div class="navbar-inner">
            <div class="container">
                <button type="button" class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="brand" href="#">PBBbyPsyl0</a>
                <div class="nav-collapse collapse">
                    <ul class="nav">
                        <li class="active"><a href="#">Home</a></li>
                        <li><a href="#about">About</a></li>
                        <li><a href="#contact">Contact</a></li>
                        <li class="dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">Dropdown <b
                                    class="caret"></b></a>
                            <ul class="dropdown-menu">
                                <li><a href="#">Action</a></li>
                                <li><a href="#">Another action</a></li>
                                <li><a href="#">Something else here</a></li>
                                <li class="divider"></li>
                                <li class="nav-header">Nav header</li>
                                <li><a href="#">Separated link</a></li>
                                <li><a href="#">One more separated link</a></li>
                            </ul>
                        </li>
                    </ul>
                    <form class="navbar-form pull-right">
                        <input class="span2" type="text" placeholder="Email">
                        <input class="span2" type="password" placeholder="Password">
                        <button type="submit" class="btn">Sign in</button>
                    </form>
                </div>
                <!--/.nav-collapse -->
            </div>
        </div>
    </div>
    <div class="container">
        <!-- Main hero unit for a primary marketing message or call to action -->
        <div class="hero-unit">
          <h2>Welcome to PBB-by-Psyl0</h2>
          <p>
              This is a history log of what is playing on PBB Radio. This site is currently under construction... by then end I would like to offer a way to search by time and also display statistics.<br/>
        I started this project by the end of April 2021... and I'm still looking to put this online. </p>
          <!-- <p><a href="#" class="btn btn-primary btn-large">Learn more »</a></p> -->
        </div>
        <!-- Example row of columns -->
        <div class="row">
          <div class="span8">
            <h2>Latest track played</h2>
            <p>
                <div id="content"></div>
            </p>
            <!-- <p><a class="btn" href="#">View details »</a></p> -->
          </div>
          <div class="span3">
            <h4>Debug output</h4>
            <p>
                <div id="time"> </div>
                <div id="load"> </div>
                <div id="saved"> </div>            
            </p>
            <!-- <p><a class="btn" href="#">View details »</a></p> -->
         </div>
        </div>
        <hr>
  
        <footer>
          <p>© PBBbyPsyl0 2021</p>
        </footer>
  
      </div>
    <hr />
    <!-- Le javascript  ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="/bootstrap/js/bootstrap.min.js"></script>

</body>

</html>